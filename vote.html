
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>City Linked Voting</title>
</head>
<body>
  <h2>Vote Page</h2>
  <button onclick="voteCity('Bangkok')">Vote for Bangkok</button>
  <button onclick="voteCity('Lisbon')">Vote for Lisbon</button>
  <p id="status"></p>

  <script type="module">
    import { castVote } from './firebase-vote.js';

    function getOrCreateUserId() {
      const key = "CLVoteUserID";
      let id = localStorage.getItem(key);
      if (!id) {
        id = "user_" + Math.random().toString(36).substring(2, 10);
        localStorage.setItem(key, id);
      }
      return id;
    }

    window.voteCity = async function(city) {
      const userId = getOrCreateUserId();
      try {
        await castVote(userId, city);
        document.getElementById("status").innerText = `✅ Vote for ${city} registered!`;
      } catch (e) {
        document.getElementById("status").innerText = "❌ Error submitting vote.";
        console.error(e);
      }
    };
  </script>
</body>
</html>
