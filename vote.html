
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CITY LINKED | Weekly Vote</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #1a1a1a;
      color: white;
      text-align: center;
      padding: 30px;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    .city-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }
    .city-button {
      background-color: #fff;
      color: #000;
      padding: 15px 25px;
      border: none;
      border-radius: 10px;
      margin: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .city-button:hover {
      background-color: #00b4db;
      color: white;
    }
    #thank-you {
      margin-top: 30px;
      font-size: 20px;
      color: lightgreen;
    }
  </style>
</head>
<body>
  <h1>üåç CITY LINKED Voting</h1>
  <p>Select your favorite city below. The winner will be unlocked Friday!</p>

  <div id="city-buttons" class="city-container"></div>
  <div id="thank-you" style="display:none;">‚úÖ Thanks for voting!</div>

  <script>
    const adminKey = "710887";
    const isAdmin = new URLSearchParams(window.location.search).get("admin") === adminKey;
    const cities = ["Amsterdam", "Lisbon", "Bangkok", "Rome", "Buenos Aires"];
    const cityContainer = document.getElementById("city-buttons");
    const thankYou = document.getElementById("thank-you");

    const hasVoted = localStorage.getItem("votedThisWeek");

    if (hasVoted && !isAdmin) {
      cityContainer.innerHTML = "";
      thankYou.innerText = "‚úÖ You've already voted this week. Come back next Monday!";
      thankYou.style.display = "block";
    } else {
      cities.forEach(city => {
        const btn = document.createElement("button");
        btn.className = "city-button";
        btn.textContent = city;
        btn.onclick = () => handleVote(city);
        cityContainer.appendChild(btn);
      });
    }

    function handleVote(city) {
      cityContainer.innerHTML = "";
      thankYou.innerText = "‚úÖ Thanks for voting!";
      thankYou.style.display = "block";
      localStorage.setItem("votedThisWeek", "true");

      if (isAdmin) {
        // Admin creates vote_request.json on GitHub (handled by backend Action)
        fetch("https://CITY-LINKED.github.io/city-linked-data/vote_request.json", {
          method: "PUT", // note: this won't work directly in browser; GitHub Actions watches the file via commits
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            timestamp: new Date().toISOString(),
            user: "admin_710887",
            city: city
          })
        }).then(() => {
          console.log("Admin vote registered for:", city);
        }).catch(() => {
          console.log("Simulated admin vote.");
        });
      }
    }
  </script>
</body>
</html>
